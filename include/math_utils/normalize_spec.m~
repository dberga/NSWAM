function [ out_map ] = normalize_spec( in_map, smin, smax)
    
    
    
    %remove outliers
    sorted_in_map = sort(in_map(:));
    mmin = min(min(in_map));
    mmin2=sorted_in_map(2);
    if abs(mmin) - abs(mmin2) > mean(std(in_map))
        mmin=mmin2;
        in_map(in_map < mmin) = mmin;
    end
    mmax = max(max(in_map));
    mmax2 = sorted_in_map(end-1);
    if abs(mmax) - abs(mmax2) > std(in_map(:,:))
        mmax=mmax2;
        in_map(in_map > mmax) = mmax;
    end
    
    
    %MOVE MATRIX, NEGATIVES TO POSITIVES
    if mmin < 0
        in_map = in_map + abs(mmin);
    end
    
    
    %MAP VALUES TO 0...1
    mmax = max(max(in_map));
    
    in_map = in_map./mmax;
    
    %MAP VALUES TO 0...MAX
    in_map = in_map .* (smax-smin);
    
    
    %MOVE MIN TO DESIRED MIN
    mmin = min(min(in_map));
    if mmin < smin
        in_map = in_map + (abs(smin) - abs(mmin));
    else
        in_map = in_map - (abs(smin) - abs(mmin));
    end
    
    out_map = in_map;

end

